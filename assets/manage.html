<!DOCTYPE html>
<html>

<head>
    <title>Shortlink Management</title>
    <link rel="stylesheet" type="text/css" media="screen" href="/static/style.css" />
</head>

<body>

    <p class="version-header">version {{.AppVersion}} [{{.AppCommit}} ({{.AppDate}})]</p>

    <h2 style="text-align: center; margin-top: 40px;">CREATED LINKS</h2>
    <table style="width:100%" border="1" id="linktable">
        <tr>
            <th>RootLink</th>
            <th>ShortLink</th>
            <th>CreatedAt</th>
            <th>Accesses</th>
            <th>LastAccess</th>
            <th>Action</th>
        </tr>
    </table>

    <hr style="margin-top: 50px;"/>
    <center style="margin-top: 50px;">
        <h2>CREATE SHORT LINK</h2>
        <form action="/createShortUrl" method="POST">
            <p>LONG URL:</p>
            <input class="textbox" type="text" name="rooturl" autocomplete="off"/>
            <p>SHORT (leave empty for random one):</p>
            <input class="textbox" type="text" name="shortlink" autocomplete="off"/>
            <input type="hidden" name="creationtoken" value="{{.TokenHash}}"/>
            <input type="hidden" name="frommanagepage" value="1">
            <br>
            <br>
            <input class="button" type="submit" value="CREATE">
        </form>
    </center>

    <script>
        var $ = (query) => document.querySelector(query);

        var linktable = $('#linktable');

        var a = {{.ShortLinks}};

        function setClipboardText(text){
            var id = 'mycustom-clipboard-textarea-hidden-id';
            var existsTextarea = document.getElementById(id);

            if (!existsTextarea){
                var textarea = document.createElement('textarea');
                textarea.id = id;
                textarea.style.position = 'fixed';
                textarea.style.top = 0;
                textarea.style.left = 0;
                textarea.style.width = '1px';
                textarea.style.height = '1px';
                textarea.style.padding = 0;
                textarea.style.border = 'none';
                textarea.style.outline = 'none';
                textarea.style.boxShadow = 'none';
            
                textarea.style.background = 'transparent';
                document.querySelector('body').appendChild(textarea);
                existsTextarea = document.getElementById(id);
            }
        
            existsTextarea.value = text;
            existsTextarea.select();
        
            try {
                var status = document.execCommand('copy');
                if (!status){
                    window.alert('Could not copy shortlink to clipboard.');
                } else {
                    window.alert('Shortlink copied to clipboard.');
                }
            } catch (err) {
                window.alert('Could not copy shortlink to clipboard.');
            }
        }

        a.reverse().forEach(l => {
            var row = document.createElement('tr');

            var frootlink = document.createElement('td');
            frootlink.innerHTML = `<a href="${l.RootLink}" target="_blank">${l.RootLink}</a>`;
            row.appendChild(frootlink);

            var fshortlink = document.createElement('td');
            fshortlink.innerHTML = `<a href="javascript:{}">${l.ShortLink}</a>`;
            fshortlink.onclick = () => {
                setClipboardText(window.location.origin + '/' + l.ShortLink);
            };
            row.appendChild(fshortlink);

            var fcreated = document.createElement('td');
            fcreated.innerHTML = l.Created;
            row.appendChild(fcreated);

            var faccesses = document.createElement('td');
            faccesses.innerHTML = l.Accesses;
            row.appendChild(faccesses);

            var flastaccess = document.createElement('td');
            flastaccess.innerHTML = l.LastAccess;
            row.appendChild(flastaccess);

            var fremove = document.createElement('td');
            var formremove = document.createElement('form');
            formremove.action = '/deleteShortUrl';
            formremove.method = 'POST';
            formremove.innerHTML = `
                <input class="button" type="submit" value="REMOVE">
                <input type="hidden" name="shortlink" value="${l.ShortLink}">
                <input type="hidden" name="tokenhash" value="{{.TokenHash}}">
                <input type="hidden" name="frommanagepage" value="1">
            `;
            fremove.appendChild(formremove);
            row.appendChild(fremove);

            linktable.appendChild(row);
        });
        
    </script>

</body>

</html>